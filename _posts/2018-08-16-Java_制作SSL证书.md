---
layout:     post
title:      "【Java】制作SSL证书"
tags:
    - Java
---

制作SSL证书
-----------
``` java
# 打开cmd命令窗口，指定使用RSA算法生成一个颁发证书的机构
keytool -genkey -alias demo -keypass 123456 -keyalg RSA -keysize 1024 -validity 365 -keystore F:/keys/demo.keystore -storepass 123456

# 使用export命令导出cer证书
keytool -export -alias demo -keystore F:/keys/demo.keystore -storepass 123456 -rfc -file F:/keys/demo.crt

# keytool不提供命令导出私钥，所以需要编写java类导出key
public class Ssl {
 
    public static KeyStore getKeyStore(String keyStorePath, String password) throws Exception {
        FileInputStream is = new FileInputStream(keyStorePath);
        KeyStore ks = KeyStore.getInstance("JKS");
        ks.load(is, password.toCharArray());
        is.close();
        return ks;
    }
 
    public static PrivateKey getPrivateKey() {
        try {
            BASE64Encoder encoder = new BASE64Encoder();
            KeyStore ks = getKeyStore("F:/keys/demo.keystore", "123456");
            PrivateKey key = (PrivateKey) ks.getKey("demo", "123456".toCharArray());
            String encoded = encoder.encode(key.getEncoded());
            System.out.println("-----BEGIN RSA PRIVATE KEY-----");
            System.out.println(encoded);
            System.out.println("-----END RSA PRIVATE KEY-----");
            return key;
        } catch (Exception e) {
            return null;
        }
    }
    
    public static void main(String[] args) {
        getPrivateKey();
    }
}

# 免密码操作
openssl rsa -in F:/keys/demo.key -out F:/keys/demo.key.unsecure

# tomcat启动https协议
<Connector port="443" protocol="org.apache.coyote.http11.Http11NioProtocol"
           maxThreads="150" SSLEnabled="true" scheme="https" secure="true"
           clientAuth="false" sslProtocol="TLS"
           keystoreFile="F:\keys\demo.keystore" 
           keystorePass="123456" />
```